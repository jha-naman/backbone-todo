<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
        <title>Todo</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.0/backbone.localStorage-min.js" type="text/javascript"></script>
        <link href="http://mincss.com/entireframework.min.css" rel="stylesheet" type="text/css">   
           
    </head>
    <body>
    <div id='container'>
        <div id="input">
            Title: <input type="text" id='title' placeholder='Enter item to do here' autofocus>
            Category: <input type="text" id='category' placeholder='Enter Category of todo'>
            <input type="button" id='add' value='Submit' >
        </div>
        <h4> ToDo List </h4>
            <div id="todo-list">
                
            </div>
        </table>
    </div>
        <script type="text/template" charset="utf-8" id='todo'>
            <span class='todo-title'> <%- title %>  </span>
            <span class='todo-category'> <%- title %>  </span>
            <span class='todo-completed'> <%- completed %> </span>
            <input type=button name="toggle" value='Toggle Status' id=' <%- id %> ' onCLick=appView.toggle(this)> 
        </script>
        <script type="text/template" charset="utf-8" id='category-template'>
            <h3> Category: <%- category %> </h3>
            <div class="insert-here">
                
            </div>
        </script>
        <script type="text/javascript" charset="utf-8">
var app = {}

app.todo = Backbone.Model.extend({
            defaults: {
                title: '',
                category: 'misc',
                completed: false,
                id: undefined
            }
        });
app.todolist = Backbone.Collection.extend({
            model: app.todo,
            localStorage: new Store('ToDo-store')
        });
app.List = new app.todolist();


app.categoryView = Backbone.View.extend({
            template: _.template($('#category-template').html()),
            render: function() {
                // this.$el.html(this.template({this.category}));
                //this line causes an error
            }
        });

app.todoView = Backbone.View.extend({
            className: 'insert-here',
            template: _.template($('#todo').html()),
            render: function() {
                this.$el.html(this.template(this.model.toJSON()));
                return this;
            }
        });
app.View = Backbone.View.extend({
        el: '#container',
        initialize: function() {
            app.List.on('add reset', this.addAll, this);
            app.List.fetch();
            
        },
        events: {
        'click #add': 'addToList',
        },
        id: 0,
        addToList: function() {
            var catView = new app.categoryView();

            var title = $('#title').val();
            var category = $('#category').val();
            app.List.add({'title': title, 'category': category, completed: false, id: ++(this.id)});
        },
        addAll: function() {
            $('#todo-list').html('');
            app.List.forEach(this.addOne, this);
        },
        addOne: function(todo) {
            var view = new app.todoView({model: todo});
            $('#todo-list').append(view.render().el);
        },
        toggle: function(element) {
           var model = app.List.get(parseInt(element.id));
           model.set('completed', !model.get('completed'));
           appView.addAll();
        }
});
var appView = new app.View();
        </script>
    </body>
</html>
